<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Regression Model</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/lumen.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="analysis.html">Analysis</a>
</li>
<li>
  <a href="model.html">Regression Model</a>
</li>
<li>
  <a href="https://ym2813.shinyapps.io/interactive_map_p8105_final/">Interactive Map</a>
</li>
<li>
  <a href="report.html">Report</a>
</li>
<li>
  <a href="https://www.youtube.com/">
    <span class="fa fa-youtube fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/P8105Final/P8015_Final_Project">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Regression Model</h1>

</div>


<div id="goal" class="section level1">
<h1>Goal</h1>
<p>In this section the goal is to apply the time series analysis to fit a model to predict future New York shooting occurrences in one month. We will use the data from New York police department and count the shooting events for each month from Jan 2006 to Dec 2020.</p>
<p>We want to use the SARIMA model to fit the seasonal pattern of the shooting occurrences plus forecast the future monthly occurrences. Model selection and diagnostic will be performed to obtain a good quality model.</p>
<p>We are also interested about whether the COVID affects the shooting patterns. So we use the 2006 - 2018 data as the training set, and 2019-2020 data as the test set to compare with the prediction of the SARIMA model.</p>
</div>
<div id="data-visualization" class="section level1">
<h1>Data visualization</h1>
<p>First we make a time series plot about the data and try to observe the trend, variability and the seasonality.</p>
<p><img src="model_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>From this plot we can observe:</p>
<ol style="list-style-type: decimal">
<li><p>For the trend, the average shooting events is actually decreasing overtime, except the last year 2020, after COVID outbreak, there was a huge spike of occurrences.</p></li>
<li><p>For the variation, it seems except the last year, the variation tends to decrease.</p></li>
<li><p>For the seasonality, there is a very significant seasonality that in winter there are less shootings and in summer there are more. Probably because winter people will not go out so much compared to summer.</p></li>
</ol>
<p>Also we can check the seasonality by plot each years data by different colors. From the plot below there is a clear spike in summer for all of the years.</p>
<p><img src="model_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
</div>
<div id="data-transformation" class="section level1">
<h1>Data transformation</h1>
<p>Now we need transformation to make the data suitable for fitting the SARIMA model. The SARIMA model assumes the data need to be stationary, without any seasonality trend, and have equal variance.</p>
<p>First we check whether we need to apply a box-cox transformation to stablize the variance.</p>
<p><img src="model_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>As the 95% interval for the best lambda parameter of the box cox transformation does not include 1, so we should use the box cox transformation with lambda = 0.263.</p>
<p>Then to remove the seasonality trend, we apply a log 12 difference. It does not seems very stationary, so we apply additional lag 1 difference. Now it looks quite good and we can proceed to select the model.</p>
<p><img src="model_files/figure-html/unnamed-chunk-5-1.png" width="672" /><img src="model_files/figure-html/unnamed-chunk-5-2.png" width="672" /></p>
</div>
<div id="model-selection" class="section level1">
<h1>Model selection</h1>
<p>First let us check the sample ACF, PACF of the series after transformation:</p>
<p><img src="model_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>The ACF plot, in non seasonality part (&lt; lag 8), we have significant lag 1 only, and the seasonality part have significant lag 12 and marginally significant lag 24, so the MA part could be MA1, and the SMA part should be 1 or 2.</p>
<p>The PACF plot, in non seasonality part (&lt; lag 8), the lag tails off, and for the seasonality part, also we can observe the lag spike tails off, (or it’s the first 2 significant). So the AR part should be 0 and the SAR part can be 0 or 2.</p>
<p>So the most probable candidate models should be <span class="math inline">\(SARIMA(p,1,q)(P,1,Q)_{12}\)</span> with <span class="math inline">\(p=0\)</span>, <span class="math inline">\(q = 1,2\)</span>, <span class="math inline">\(P = 0, 2\)</span>, <span class="math inline">\(Q = 1,2\)</span>.</p>
<p>We fit those models and calculate the AICc of those models fitted by R. The result is:</p>
<table>
<caption>AICCs of the models</caption>
<thead>
<tr class="header">
<th align="left">Model</th>
<th align="right">AICc</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">SARIMA(0,1,1)(0,1,1)_12</td>
<td align="right">262.6220</td>
</tr>
<tr class="even">
<td align="left">SARIMA(0,1,1)(0,1,2)_12</td>
<td align="right">264.0517</td>
</tr>
<tr class="odd">
<td align="left">SARIMA(0,1,1)(2,1,1)_12</td>
<td align="right">265.7343</td>
</tr>
<tr class="even">
<td align="left">SARIMA(0,1,1)(2,1,2)_12</td>
<td align="right">268.0756</td>
</tr>
<tr class="odd">
<td align="left">SARIMA(0,1,2)(0,1,1)_12</td>
<td align="right">264.6530</td>
</tr>
<tr class="even">
<td align="left">SARIMA(0,1,2)(0,1,2)_12</td>
<td align="right">265.9070</td>
</tr>
<tr class="odd">
<td align="left">SARIMA(0,1,2)(2,1,1)_12</td>
<td align="right">267.5682</td>
</tr>
<tr class="even">
<td align="left">SARIMA(0,1,2)(2,1,2)_12</td>
<td align="right">269.7245</td>
</tr>
</tbody>
</table>
<p>From the table, the model <span class="math inline">\(SARIMA(0,1,1)(0,1,1)_{12}\)</span> has the smallest AICc so it’s the best. The model summary is:</p>
<pre><code>## Series: train1 
## ARIMA(0,1,1)(0,1,1)[12] 
## 
## Coefficients:
##           ma1     sma1
##       -0.7592  -0.8463
## s.e.   0.0629   0.0917
## 
## sigma^2 estimated as 0.3194:  log likelihood=-128.22
## AIC=262.45   AICc=262.62   BIC=271.34
## 
## Training set error measures:
##                       ME      RMSE       MAE        MPE     MAPE      MASE
## Training set -0.01589969 0.5372774 0.4100619 -0.3197275 4.304198 0.6802193
##                   ACF1
## Training set 0.0195208</code></pre>
<p>And the mathematical form is: (After box cox transformation with lambda = 0.263)</p>
<p><span class="math display">\[
(1-B)(1-B^{12})X_n=(1-0.7592B)(1-0.8463B^{12})Z_n
\]</span></p>
<p><span class="math display">\[ Z_n \overset{iid}\sim N[0,0.3194]\]</span></p>
</div>
<div id="model-diagnostic" class="section level1">
<h1>Model diagnostic</h1>
<p>First we check the ACF and PACF of the residual. The residual should assemble white noise so the AFC and PACF should not contain any significant spikes. From the ACF and PACF plot, except lag4 is marginally significant, all others are good, so we think the residual is similar to white noise for the ACF and PACF.</p>
<p><img src="model_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>From the result, except for the lag 14 very marginally spike of the ACF and PACF (Which may because some complex patterns in the data), all other lags are insignificant, so we can believe the ACF and PACF of the residual is quite similar to the white noise.</p>
<p>Then check the inverse polynomial roots. The characteristic roots should be outside the unit circle to assure the model stationary and invertible, thus the inverse characteristic roots should be inside the unit circle. From the plot below all the inverse characteristic roots are inside the unit circle. so the model is legible.</p>
<p><img src="model_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>Next we check the model residual independence:</p>
<p>Use Box - Pierce test, Ljung - Box test and McLeod - Li test. The training data have 156 observations, model parameters 2, so the degree of freedom should be 12, 12, 14 respectively.</p>
<table>
<thead>
<tr class="header">
<th align="left">tests</th>
<th align="right">p.value</th>
<th align="right">df</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Box-Pierce</td>
<td align="right">0.2836037</td>
<td align="right">12</td>
</tr>
<tr class="even">
<td align="left">Ljung-Box</td>
<td align="right">0.2311293</td>
<td align="right">12</td>
</tr>
<tr class="odd">
<td align="left">McLeod-Li</td>
<td align="right">0.9971713</td>
<td align="right">14</td>
</tr>
</tbody>
</table>
<p>All of the independence tests pass with p value &gt; 0.05, so our residual does not have any sequential correlation.</p>
</div>
<div id="forecast" class="section level1">
<h1>Forecast</h1>
<p>Now we forecast the model on the test set:</p>
<p><img src="model_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>The forecast result shows that in 2019, all blue points (real values) are inside the 95% confidence interval, and actually quite close to the predicted red points. But in 2020, nearly all predicted value are smaller than the actual value, and in summer the actual value is much higher than the predicted ones.</p>
<p>This is because after April the COVID outbreaks in US. The economy was greatly suffered so the social become violent thus much more shooting occurs. Our SARIMA model can’t take that COVID event into consideration, and still predict it as the COVID does not exist, so that’s why our predicted values are much smaller than the actual values. In fact, no model can forecast those black swarm events.</p>
<p>Also from the disparity of the predicted and actual shooting numers in 2020, we can have a feeling of how big influence that COVID bring to US.</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
