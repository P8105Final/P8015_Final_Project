---
title: "Descriptive Analysis"
output: 
  html_document:
    toc: true
    toc_float: true
---
```{r include=FALSE, echo = FALSE}
library(tidyverse)
library(readr)
knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
theme_set(theme_minimal() + theme(legend.position = "bottom",plot.title = element_text(face = "bold")))
```


```{r,include=FALSE, echo = FALSE}
data_hist = 
  read_csv("data/NYPD_Shooting_Incident_Data_Clean.csv") %>%
  mutate(
    statistical_murder_flag = as.character(statistical_murder_flag),
    statistical_murder_flag = recode(statistical_murder_flag, "FALSE" = "survived","TRUE" = "murdered")
  )

```



```{r, include=FALSE}
educational = read_csv("data/education/educational_attainment.csv") 

unemployment <- read_csv("data/unemployment/unemployed_complete.csv")
```
 

# Overall glance

At the very beginning, let's have a overall glance at the shooting incidence and focusing on the most serious issue, which is the amount of death on shooting incident from **2006 to 2020** in New York City.

```{r echo = FALSE, message=FALSE}
year_plot = 
  data_hist %>% 
  filter(year >= 2006 ) %>% 
  group_by(year, statistical_murder_flag) %>%
  summarise(n = n()) %>% 

  ggplot(aes(x = year, y = n, color = statistical_murder_flag))  + scale_x_continuous(breaks = seq(2006, 2020, by = 1)) +
  geom_point() + geom_line() +
  labs(x = "Year",
       y = "Total incident",
       title = "Shooting Incident Trend By Year"
       )

year_plot
```

*comment*  
Murdered shooting incidence is much less than survived shooting incidence. From 2006 to 2011, the survived shooting incidence was steadily fluctuate around 1500 and murdered shooting incidence was steadily fluctuate around 400.Both types of the shooting incidence were decreasing gradually from 2010 to 2019. However, there is a huge dramatically increase in 2020. We suspect it might be influenced by the outbreak of COVID-19 which led to a raise in unemployment and panic. We will do more statistical analysis on that later.


Now, let's take a closer look on more details about the victims.

# Victim
## Race

```{r echo = FALSE, message= FALSE}
vic_race_plot = 
  data_hist %>%
  filter(year >= 2006,
         vic_race %in% c("black","white hispanic","black hispanic","white","asian / pacific islander","white")) %>% 
  group_by(year, vic_race) %>%
  summarise(n = n()) %>%
  ggplot(aes(x = year, y = n, fill= vic_race) ) + scale_x_continuous(breaks = seq(2006, 2020, by = 1)) +
  geom_bar(width = 0.8, stat = "identity") +
  labs(x = "Year",
       y = "Total incident",
       title = "Shooting Incident Trend By Victim’s Race")
       
vic_race_plot
```

*comment*  
The majority of victim are **black**. In 2010, 2011 and 2014, white people are the second highest number of victim. The rest of years, white hispanic are the second most among all victim's race.


## Sex
```{r echo = FALSE, message=FALSE}
vic_sex_plot = 
  data_hist %>% 
  filter(year >= 2006,
         vic_sex != "unknown") %>% 
  group_by(year, vic_sex) %>%
  summarise(n = n()) %>% 
  ggplot(aes(x = year, y = n, fill = vic_sex)) + scale_x_continuous(breaks = seq(2006, 2020, by = 1)) +
  geom_boxplot() +
  labs(x = "Year",
       y = "Total incident",
       title = "Shooting Incident Trend By Victim’s Sex")


vic_sex_plot
```

*comment*  
**Male** victims are the majority and female victims have a very small proportion among the total victims in nyc across 2006 to 2020.


## Age

```{r echo = FALSE, message=FALSE}
vic_age_plot = 
  data_hist %>% 
  filter(year >= 2006,
         vic_age_group != "NA",
         vic_age_group != "UNKNOWN"
         ) %>% 
  group_by(vic_age_group, year) %>%
  summarise(n = n()) %>% 

  ggplot(aes(x = year, y = n, color = vic_age_group)) + scale_x_continuous(breaks = seq(2006, 2020, by = 1)) +
  geom_point() + geom_line() +

  labs(x = "Year",
       y = "Total incident",
       title = "Shooting Incident Trend By victim's Age group"
       )
vic_age_plot
```

*comment*  
The proportion of age group under 18 and 45-64 have been keeping consistently low across 2006 to 2020, and there are nearly zero incidence for age group over 65.
From 2006-2014, age group 18-24 and age group 25-44 have the highest proportion among the shooting incident. But since 2015, the amount of group 18-24 victims have been decreasing rapidly and become the second highest group among the total shooting incident. 18-24 usually is the age to graduate from high school and enter to college, this decrease may referring to some educational policy from 2015.Then we want to see what happened in perpetrator later.

## Place
```{r echo = FALSE, message = FALSE}
jurisdiction_code_plot=
  data_hist %>%
  filter(year > 2006,
         vic_age_group != "NA",
         vic_age_group != "UNKNOWN") %>% 
  group_by(jurisdiction_code, vic_age_group) %>%
  summarise(n = n()) %>% 
  ggplot(aes(x = vic_age_group, y = n, fill = jurisdiction_code)) +
  geom_bar(width = 0.8, stat = "identity") +
  labs(x = "Age group of victims",
       y = "Total incident",
       title = "Shooting Incident By Location Of The Incident"
       )

  
jurisdiction_code_plot
```

*comment*  
Most of the shooting incidences happened in the **patrol**, some of the shooting incidences in housing and only few cases were on transit.

## Hour in a day

```{r echo=FALSE, message=FALSE}
incident_by_hour =
  data_hist %>%
  filter(year >= 2006) %>% 
  group_by(hour) %>%
  mutate(n = n()) %>% 
  ggplot(aes(x = hour, group = n)) + 
  geom_bar(position = "dodge") +
  facet_grid(rows = vars(boro)) +
  labs(x = "Hour",
       y = "Total incident",
       title = "Shooting Incident Trend By Hour In Day"
       )
  
incident_by_hour
```

*comment*  
**Brooklyn** has most shooting incident, then is bronx. Staten island has least shooting incident since it does not have much population.
Most of the shooting incidence happened at night and very early in the morning. For Bronx and Brooklyn,  the shooting incidence are gradually increasing after 12pm and reach to peaks around 10pm to 11pm. The shooting incidences in the morning are not as high as the shooting incidences at night. For queens and manhanttan, the shooting incidences in the morning reach to the highest peak and have a noteworthy amount until 5 am. We will provide more statistical analysis about which borought is the most dangerous in next section.

# Perpetrator

## Age
```{r echo=FALSE,message=FALSE}
perp_age_plot = 
  data_hist %>% 
  filter(year >= 2006,
         perp_age_group != "NA",
         perp_age_group != "unknown"
         ) %>% 
  group_by(perp_age_group, year) %>%
  summarise(n = n()) %>% 

  ggplot(aes(x = year, y = n, color = perp_age_group)) + 
  geom_point() + geom_line() +

  labs(x = "Year",
       y = "Total incident",
       title = "Shooting Incident Trend By Perpetrator's Age group"
       )
perp_age_plot
```

*comment*  
From the plot we can see same situation happened and more obvious. From 2006-2014, majority perpetrator are from age group 18-24 in the shooting incident. But since 2015, the amount of group 18-24 perpetrator have been decreasing rapidly. we infer that both of the perpetrators and victims might be influenced by the education level. Therefore, we visualize educational plot to verify our deduction. The association between the educational level and perpetrator's age group and victim's age is required more analysis.


# Education
```{r echo = FALSE, message=FALSE}
education_plot = 
  educational %>%
  ggplot(aes(x = year, y = percent, color = boro)) + scale_x_continuous(breaks = seq(2010, 2020, by = 1)) +
  geom_line() +
  labs(
    title = "Education", 
    x =  "Year",
    y = "Percent") 

education_plot
```

*comment*  
This plot shows the percentage change in each borough over the year that every person over 18 with high school education or above. All borough have the upward trend in last 10 years. However, brooklyn the one with most shooting incident borough has a notability increase slope in 2015, which matched our forecast about the association with age group and education. We conclude that when education increase, the shooting incident decrease.

# Unemployment
```{r echo=FALSE,message=FALSE}
unemployment_plot = 
  unemployment %>%
  ggplot(aes(x = year, y = unemployment_rate)) +
  geom_point() +
  geom_smooth()
unemployment_plot
```

*comment*  
According to the plot, we can see the unemployment rate was decreasing from 2010 to 2019. There is an exaggerated increase in the unemployment rate in 2020, which matched our forecast about the association with total shooting incident and unemployment rate. We conclude that when unemployment increase, the shooting incident increase. 
