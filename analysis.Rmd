---
title: "Analysis"
output: 
  html_document:
    toc: true
    toc_float: true
---
```{r include=FALSE, echo = FALSE}
library(tidyverse)
knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
theme_set(theme_minimal() + theme(legend.position = "bottom",plot.title = element_text(face = "bold")))
```


```{r,include=FALSE, echo = FALSE}
data_hist = 

 
  read_csv("data/NYPD_Shooting_Incident_Data_Clean.csv") %>%
  mutate(
    statistical_murder_flag = as.character(statistical_murder_flag),
    statistical_murder_flag = recode(statistical_murder_flag, "FALSE" = "survived","TRUE" = "murdered")
  )

```



```{r, include=FALSE}
educational_attainment = read_csv("data/education/educational_attainment.csv") 
```
 

# Overall glance

## 2010-2020 total shooting incident trends by murdered or survived from 2006 to 2020
At the very beginning, let's have a overall glance at the shooting incidence and focusing on the most serious issue, which is the amount of death on shooting incident from 2006 to 2020 in New York City.
```{r echo = FALSE, message=FALSE}
year_plot = 
  data_hist %>% 
  filter(year >= 2006 ) %>% 
  group_by(year, statistical_murder_flag) %>%
  summarise(n = n()) %>% 

  ggplot(aes(x = year, y = n, color = statistical_murder_flag))  + scale_x_continuous(breaks = seq(2006, 2020, by = 1)) +
  geom_point() + geom_line() +
  labs(x = "Year",
       y = "Total incident",
       title = "Shooting Incident Trend By Year"
       )

year_plot
```

Murdered shooting incidence is much less than survived shooting incidence. From 2006 to 2011, the survived shooting incidence was steadily fluctuate around 1500 and murdered shooting incidence was steadily fluctuate around 400. Both types of the shooting incidence were decreasing gradually from 2011 to 2019. However, there is a huge dramatically increase in 2020 for both types of the shooting incidence. 


Now, let's take a closer look on more details about the victims.

# Victim
## 2010-2020 total shooting incident by victim’s race

```{r echo = FALSE, message= FALSE}
vic_race_plot = 
  data_hist %>%
  filter(year >= 2006,
         vic_race %in% c("black","white hispanic","black hispanic","white","asian / pacific islander","white")) %>% 
  group_by(year, vic_race) %>%
  summarise(n = n()) %>%
  ggplot(aes(x = year, y = n, fill= vic_race) ) + 
  geom_bar(width = 0.8, stat = "identity") +
  labs(x = "Year",
       y = "Total incident",
       title = "Shooting Incident Trend By Victim’s Race")
       
vic_race_plot
```

The majority of victim are **black**. In 2010, 2011 and 2014, white people are the second highest number of victim. the rest of years, white hispanic are the second most in victim.


## 2010-2020 total shooting incident by victim’s sex
```{r echo = FALSE, message=FALSE}
vic_sex_plot = 
  data_hist %>% 
  filter(year >= 2006,
         vic_sex != "unknown") %>% 
  group_by(year, vic_sex) %>%
  summarise(n = n()) %>% 
  ggplot(aes(x = year, y = n, fill = vic_sex)) + 
  geom_bar(width = 0.8, stat = "identity") +
  labs(x = "Year",
       y = "Total incident",
       title = "Shooting Incident Trend By Victim’s Sex")


vic_sex_plot
```

Male victims are the majority and female victims have a very small proportion among the total victims in nyc across 2006 to 2020.


## 2010-2020 totalshooting incident by victim’s age group

```{r echo = FALSE, message=FALSE}
vic_age_plot = 
  data_hist %>% 
  filter(year >= 2006,
         vic_age_group != "NA",
         vic_age_group != "UNKNOWN"
         ) %>% 
  group_by(vic_age_group, year) %>%
  summarise(n = n()) %>% 

  ggplot(aes(x = year, y = n, color = vic_age_group)) + 
  geom_point() + geom_line() +

  labs(x = "Year",
       y = "Total incident",
       title = "Shooting Incident Trend By victim's group"
       )
vic_age_plot
```

The proportion of age group under 18 and 45-64 have been keeping consistently low across 2006 to 2020, and there are nearly zero incidence for age group over 65.
From 2006-2014, age group 18-25 and age group 25-44 have the highest proportion among the shooting incident. But since 2015, the amount of group 18-25 victims have been decreasing rapidly and become the second highest group among the total shooting incident which was referring to educational policy from 2015.


## 2010-2020 total shooting incident by jurisdiction_code
```{r echo = FALSE, message = FALSE}
jurisdiction_code_plot=
  data_hist %>%
  filter(year > 2010,
         vic_age_group != "NA",
         vic_age_group != "UNKNOWN") %>% 
  group_by(jurisdiction_code, vic_age_group) %>%
  summarise(n = n()) %>% 
  ggplot(aes(x = vic_age_group, y = n, fill = jurisdiction_code)) + 
  geom_bar(width = 0.8, stat = "identity") +
  labs(x = "Age group of victims",
       y = "Total incident",
       title = "Shooting Incident By Location Of The Incident"
       )

  
jurisdiction_code_plot
```



## 2010-2020 total shooting incident by hour in a day for each borough


```{r echo=FALSE, message=FALSE}
incident_by_hour =
  data_hist %>%
  filter(year >= 2010) %>% 
  group_by(hour) %>%
  mutate(n = n()) %>% 
  ggplot(aes(x = hour, group = n)) + 
  geom_bar(position = "dodge") +
  facet_grid(rows = vars(boro)) +
  labs(x = "Hour",
       y = "Total incident",
       title = "Shooting Incident Trend By Hour In Day"
       )
  
incident_by_hour
```




Most shooting incident happened at **patrol**, then is house.



**brooklyn** has most shooting incident, then is bronx. Staten island has least shooting incident since it dose not have much population

```{r}
education_plot = 
  educational_attainment %>%
  ggplot(aes(x = year, y = percent, color = boro)) +
  geom_line() +
  labs(
    title = "Education", 
    x =  "Year",
    y = "Percent") 

education_plot
```


overall, all borough show increase.  in 2015, brooklyn that has most shooting incident boro has a notability increase slope.

