---
title: "Analysis"
output: 
  html_document:
    toc: true
    toc_float: true
---
```{r include=FALSE}
library(tidyverse)
knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
theme_set(theme_minimal() + theme(legend.position = "bottom",plot.title = element_text(face = "bold")))
```


```{r}
data_hist = 
  read_csv("data/NYPD_Shooting_Incident_Data__Historic_.csv") %>%
  janitor::clean_names() %>%
  rename("date" = "occur_date",
         "time" = "occur_time") %>%
  separate(date, into = c("month", "day", "year"), sep = "/") %>%
  separate(time, into = c("hour", "minute"), sep = ":") %>% 
  mutate(
          boro = str_to_lower(boro),
          location_desc = str_to_lower(location_desc),
          perp_race = str_to_lower(perp_race),
          vic_race = str_to_lower(vic_race),
          perp_age_group = str_replace(perp_age_group, "UNKNOWN","unknown"),
          perp_sex = recode(perp_sex, "M" = "male","F" = "female","U" = "unknown"), 
          vic_sex = recode(vic_sex, "M" = "male","F" = "female","U" = "unknown"),
          jurisdiction_code = case_when(
            jurisdiction_code == 0 ~ "patrol", 
            jurisdiction_code == 1 ~ "transit",
            jurisdiction_code == 2 ~ "housing")
          ) %>% 
  arrange(year,month,day,hour,minute)
```



##2015-2020 total death by year
```{r}
year_plot = 
  data_hist %>% 
  filter(year > 2014) %>% 
  group_by(year) %>%
  mutate(count = n()) %>% 
  ggplot(aes(x = year, y = count)) + 
  geom_point() 

  labs(x = "Year",
       y = "Total death"
       )

year_plot
```

##2015-2020 total death by perpetrator’s sex
```{r}
sex_plot = 
  data_hist %>% 
  filter(year > 2014,
         perp_sex != "unknown") %>% 
  group_by(year, perp_sex) %>%
  mutate(n = n()) %>% 
  ggplot(aes(x = year, group = n, fill = perp_sex)) + 
  geom_bar(position = "dodge") 
  
sex_plot
```

##2015-2020 total death by perpetrator’s race
```{r}
race_plot = 
  data_hist %>% 
  filter(year > 2014,
         perp_race != "unknown") %>% 
  group_by(perp_race) %>%
  mutate(n = n()) %>% 
  ggplot(aes(x = perp_race, group = n)) + 
  geom_bar(position = "dodge") 
  
race_plot
```
##2015-2020 total death by victim’s race
```{r}
vic_race_plot = 
  data_hist %>% 
  filter(year > 2014,
         vic_race != "unknown") %>% 
  group_by(vic_race, vic_sex) %>%
  mutate(n = n()) %>% 
  ggplot(aes(x = vic_race, group = n,fill = vic_sex)) + 
  geom_bar(position = "dodge") 

vic_race_plot
```

##2015-2020 total death by victim’s sex
```{r}
vic_sex_plot = 
  data_hist %>% 
  filter(year > 2014,
         vic_sex != "unknown") %>% 
  group_by(vic_sex) %>%
  mutate(n = n()) %>% 
  ggplot(aes(x = vic_sex, group = n)) + 
  geom_bar(position = "dodge") 

vic_sex_plot
```

##2015-2020 total death by boro
```{r}
boro_plot = 
  data_hist %>% 
  filter(year > 2014) %>% 
  group_by(boro) %>%
  mutate(n = n()) %>% 
  ggplot(aes(x = boro, group = n)) + 
  geom_bar(position = "dodge") 

boro_plot
```

##2015-2020 total death by hour in day
```{r}
incident_by_hour =
  data_hist %>%
  filter(year > 2014) %>% 
  group_by(hour) %>%
  mutate(n = n()) %>% 
  ggplot(aes(x = hour, group = n)) + 
  geom_bar(position = "dodge") +
  facet_grid(~boro)
  
incident_by_hour
```
##2015-2020 total death by jurisdiction_code
```{r}
jurisdiction_code =
  data_hist %>%
  filter(year > 2014) %>% 
  group_by(jurisdiction_code) %>%
  mutate(n = n()) %>% 
  ggplot(aes(x = jurisdiction_code, group = n)) + 
  geom_bar(position = "dodge") 

  
jurisdiction_code
```
