---
title: "Analysis"
output: 
  html_document:
    toc: true
    toc_float: true
---
```{r include=FALSE}
library(tidyverse)
knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
theme_set(theme_minimal() + theme(legend.position = "bottom",plot.title = element_text(face = "bold")))
```


```{r,include=FALSE}
data_hist = 

 
  read_csv("data/NYPD_Shooting_Incident_Data_Clean.csv") %>%
  mutate(
    statistical_murder_flag = as.character(statistical_murder_flag),
    statistical_murder_flag = recode(statistical_murder_flag, "FALSE" = "survived","TRUE" = "murdered")
  )
data_hist
```


## Trend
### 2010-2020 total shooting incident trends by year
```{r}
year_plot = 
  data_hist %>% 
  filter(year >= 2010
         ) %>% 
  group_by(year, statistical_murder_flag) %>%
  mutate(n = n()) %>% 
  ggplot(aes(x = year, y = n, color = statistical_murder_flag)) +    scale_x_continuous(breaks = seq(2010, 2020, by = 1)) +
  geom_point() + geom_line()
  #facet_grid(~statistical_murder_flag)
  labs(x = "Year",
       y = "Total incident",
       title = "Shooting Incident Trend By Year"
       )

year_plot
```

## Perpetrator
### 2010-2020 total shooting incident trend by perpetrator’s sex
```{r}
perp_sex_plot = 
  data_hist %>% 
  filter(year >= 2010,
         perp_sex != "unknown") %>% 
  group_by(year, perp_sex) %>%
  mutate(n = n()) %>% 
  ggplot(aes(x = year, group = n, fill = perp_sex)) + 
  geom_bar(position = "dodge") +
  labs(x = "Year",
       y = "Total incident",
       title = "Shooting Incident Trend By Perpetrator’s Sex"
       )
  
perp_sex_plot
```

From the plot, we can easy see **male** are the majority of perpetrator. Male are generally considered to be more combative.

### 2010-2020 total shooting incident by perpetrator’s race
```{r}
perp_race_plot = 
  data_hist %>% 
  filter(year >= 2010,
         perp_race != "unknown") %>% 
  group_by(perp_race) %>%
  mutate(n = n()) %>% 
  ggplot(aes(x = year, group = n, fill = perp_race)) + 
  geom_bar(position = "dodge") +
  labs(x = "Year",
       y = "Total incident",
       title = "Shooting Incident Trend By Perpetrator’s Race"
       )
  
perp_race_plot
```

Most of perpetrator are **black**, then is white hispanic, black hispanic, white and asian/pacific islander.

### 2010-2020 totalshooting incident by perpetrator’s age group
```{r}
perp_age_plot = 
  data_hist %>% 
  filter(year >= 2010,
         perp_age_group != "NA",
         perp_age_group != "unknown"
         ) %>% 
  group_by(perp_age_group) %>%
  mutate(n = n()) %>% 
  ggplot(aes(x = year, group = n, fill = perp_age_group)) + 
  geom_bar(position = "dodge") +
  labs(x = "Year",
       y = "Total incident",
       title = "Shooting Incident Trend By Perpetrator’s Age Group"
       )
  
perp_age_plot
```
From 2010 to 2015, the majority of perpetrator are age **18-24**, then is 25-44. However, in recent 5 years(2016-2020), most of perpetrator are age **25-44**. We are wondering maybe this is because some education program or some law about college student. 

## Victim
### 2010-2020 total shooting incident by victim’s sex
```{r}
vic_sex_plot = 
  data_hist %>% 
  filter(year >= 2010,
         vic_sex != "unknown") %>% 
  group_by(vic_sex) %>%
  mutate(n = n()) %>% 
  ggplot(aes(x = year, group = n, fill = vic_sex)) + 
  geom_bar(position = "dodge") +
  labs(x = "Year",
       y = "Total incident",
       title = "Shooting Incident Trend By Victim’s Sex"
       )

vic_sex_plot
```

**male** are the majority of victim.

### 2010-2020 total shooting incident by victim’s race
```{r}
vic_race_plot = 
  data_hist %>% 
  filter(year >= 2010,
         vic_race != "unknown") %>% 
  group_by(vic_race) %>%
  mutate(n = n()) %>% 
  ggplot(aes(x = year, group = n,fill = vic_race)) + 
  geom_bar(position = "dodge") +
  labs(x = "Year",
       y = "Total incident",
       title = "Shooting Incident Trend By Victim’s Race"
       )

vic_race_plot
```
the majority of victim are **black**. In 2010, 2011 and 2014, white people are the second highest number of victim. the rest of years, white hispanic are the second most in victim

### 2010-2020 totalshooting incident by victim’s age group
```{r}
vic_age_plot = 
  data_hist %>% 
  filter(year >= 2010,
         vic_age_group != "NA",
         vic_age_group != "UNKNOWN"
         ) %>% 
  group_by(vic_age_group) %>%
  mutate(n = n()) %>% 
  ggplot(aes(x = year, group = n, fill = vic_age_group)) + 
  geom_bar(position = "dodge") +
  labs(x = "Borough",
       y = "Total incident",
       title = "Shooting Incident Trend By Perpetrator’s Age Group"
       )
  
vic_age_plot
```
same situation as perpetrator age group, 2010-2015 age 18-25 are the major victim but less in 2016-2018

## Time
### 2010-2020 total shooting incident by hour in a day
```{r}
incident_by_hour =
  data_hist %>%
  filter(year >= 2010) %>% 
  group_by(hour) %>%
  mutate(n = n()) %>% 
  ggplot(aes(x = hour, group = n)) + 
  geom_bar(position = "dodge") +
  facet_grid(rows = vars(boro)) +
  labs(x = "Hour",
       y = "Total incident",
       title = "Shooting Incident Trend By Hour In Day"
       )
  
incident_by_hour
```
the most dangerous time **21:00-1:00**, basically at dark

## Place
### 2010-2020 total shooting incident by jurisdiction_code
```{r}
jurisdiction_code =
  data_hist %>%
  filter(year > 2010) %>% 
  group_by(jurisdiction_code) %>%
  mutate(n = n()) %>% 
  ggplot(aes(x = boro, group = n, fill = jurisdiction_code)) + 
  geom_bar(position = "dodge") +
  labs(x = "Location of the incident",
       y = "Total incident",
       title = "Shooting Incident By Location Of The Incident"
       )

  
jurisdiction_code
```
Most shooting incident happened at **patrol**, then is house.

### 2010-2020 total shooting incident by boro
```{r}
boro_plot = 
  data_hist %>% 
  filter(year >= 2010) %>% 
  group_by(boro) %>%
  mutate(n = n()) %>% 
  ggplot(aes(x = boro, group = n)) + 
  geom_bar(position = "dodge") +
  labs(x = "Borough",
       y = "Total incident",
       title = "Shooting Incident By Borough"
       )

boro_plot
```
**brooklyn** has most shooting incident, then is bronx. Staten island has least shooting incident since it dose not have much population